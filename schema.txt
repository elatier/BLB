

DROP TABLE AVAILABLE_BONDS
DROP TABLE OWNED_BONDS
DROP TABLE TRANSACTIONS
DROP TABLE BONDS
DROP TABLE TRADER_GROUPS
DROP TABLE CLIENT
DROP TABLE TRADER
DROP TABLE COUNTRY_INFO
DROP TABLE RATINGS

use BLBData
go
CREATE TABLE RATINGS
(
rating smallint PRIMARY KEY,
rating_sp nchar(5) not null,
)

use BLBData
go
CREATE TABLE COUNTRY_INFO
(
country_code nchar(5) PRIMARY KEY,
settlement_time int not null,
calender nchar(1000) not null,
)

use BLBData
go
CREATE TABLE BONDS
(
cusip nchar(9) PRIMARY KEY,
name nvarchar(255) not null,
price money not null,
par_value money not null,
maturity_date date not null,
yield_to_maturity float not null,
current_yield float not null,
coupon float not null,
rating smallint not null,
country_code nchar(5) not null,
FOREIGN KEY (country_code) REFERENCES COUNTRY_INFO(country_code),
FOREIGN KEY (rating) REFERENCES RATINGS(rating)
)

use BLBData
go
CREATE TABLE AVAILABLE_BONDS
(
cusip nchar(9) PRIMARY KEY, 
quantity_available integer not null,
FOREIGN KEY (cusip) REFERENCES BONDS(cusip)
)

use BLBData
go
CREATE TABLE CLIENT
(
client_id integer PRIMARY KEY,
client_name nchar(255) not null, 
address nchar(255) not null,
company nchar(255) not null,
contact_no nchar(15) not null,
)

use BLBData
go
CREATE TABLE OWNED_BONDS
(
client_id integer,
cusip nchar(9),
quantity_owned integer not null,
FOREIGN KEY (client_id) REFERENCES CLIENT(client_id),
FOREIGN KEY (cusip) REFERENCES BONDS(cusip)
)

use BLBData
go
CREATE TABLE TRANSACTIONS
(
trasaction_id integer PRIMARY KEY IDENTITY(1,1),
date_time datetime not null DEFAULT GETDATE(),
client_id integer not null,
cusip nchar(9) not null,
quantity int not null,
FOREIGN KEY (client_id) REFERENCES CLIENT(client_id),
FOREIGN KEY (cusip) REFERENCES BONDS(cusip)
)

use BLBData
go
CREATE TABLE TRADER
(
trader_id integer PRIMARY KEY,
trader_name nchar(255) not null,
trader_username nchar(255) not null,
trader_password nchar(255) not null
)

use BLBData
go
CREATE TABLE TRADER_GROUPS
(
trader_group_id integer PRIMARY KEY,
client_id integer not null,
trader_id integer not null,
FOREIGN KEY (client_id) REFERENCES CLIENT(client_id),
FOREIGN KEY (trader_id) REFERENCES TRADER(trader_id)
)

INSERT INTO RATINGS (rating, rating_sp) VALUES (1,'AAA')
INSERT INTO RATINGS (rating, rating_sp) VALUES (2,'AA+')
INSERT INTO RATINGS (rating, rating_sp) VALUES (3,'AA')
INSERT INTO RATINGS (rating, rating_sp) VALUES (4,'AA-')
INSERT INTO RATINGS (rating, rating_sp) VALUES (5,'A+')
INSERT INTO RATINGS (rating, rating_sp) VALUES (6,'A')
INSERT INTO RATINGS (rating, rating_sp) VALUES (7,'BBB')
INSERT INTO RATINGS (rating, rating_sp) VALUES (8,'BB')
INSERT INTO RATINGS (rating, rating_sp) VALUES (9,'B')
INSERT INTO RATINGS (rating, rating_sp) VALUES (10,'CCC')
INSERT INTO RATINGS (rating, rating_sp) VALUES (11,'CC')
INSERT INTO RATINGS (rating, rating_sp) VALUES (12,'C')
INSERT INTO RATINGS (rating, rating_sp) VALUES (13,'D')

INSERT INTO COUNTRY_INFO (country_code, settlement_time, calender) VALUES ('USA', 3, 'URL1')
INSERT INTO COUNTRY_INFO (country_code, settlement_time, calender) VALUES ('SIN', 2, 'URL2')
INSERT INTO COUNTRY_INFO (country_code, settlement_time, calender) VALUES ('AUS', 3, 'URL2')


INSERT INTO BONDS (cusip, name, price, par_value, maturity_date, yield_to_maturity, current_yield, coupon, rating, country_code) VALUES (123456789, 'American Government Bond', 1, 33, '2013-05-15', 11, 12, 5, 1, 'USA')
INSERT INTO BONDS (cusip, name, price, par_value, maturity_date, yield_to_maturity, current_yield, coupon, rating, country_code) VALUES (111111111, 'Australian Government Bond', 20, 55, '2013-06-15', 22, 80, 5, 2, 'AUS')
INSERT INTO BONDS (cusip, name, price, par_value, maturity_date, yield_to_maturity, current_yield, coupon, rating, country_code) VALUES (999999999, 'Singapaore Government Bond', 50, 33, '2013-05-15', 11, 12, 5, 1, 'SIN')
INSERT INTO BONDS (cusip, name, price, par_value, maturity_date, yield_to_maturity, current_yield, coupon, rating, country_code) VALUES (222222222, 'Irish Government Bond', 70, 33, '2013-09-15', 11, 12, 5, 1, 'USA')
INSERT INTO BONDS (cusip, name, price, par_value, maturity_date, yield_to_maturity, current_yield, coupon, rating, country_code) VALUES (333333333, 'Ford Bond', 90, 55, '2013-08-15', 22, 80, 5, 2, 'AUS')
INSERT INTO BONDS (cusip, name, price, par_value, maturity_date, yield_to_maturity, current_yield, coupon, rating, country_code) VALUES (444444444, 'Chrysler Bond', 110, 33, '2013-03-15', 11, 12, 5, 1, 'SIN')

INSERT INTO AVAILABLE_BONDS (cusip, quantity_available) VALUES (123456789, 500)
INSERT INTO AVAILABLE_BONDS (cusip, quantity_available) VALUES (111111111, 250)
INSERT INTO AVAILABLE_BONDS (cusip, quantity_available) VALUES (999999999, 1000)

INSERT INTO CLIENT (client_id, client_name, address, company, contact_no) VALUES (1,'Robert Fujiwara', '34 Long Lane', 'SuperCorp', '0434928152')
INSERT INTO CLIENT (client_id, client_name, address, company, contact_no) VALUES (2,'Aomi', '34 Long Lane', 'United Steel', '08124928152')

INSERT INTO TRADER (trader_id, trader_name, trader_username, trader_password) VALUES (1,'A. DAVIS','trader1','password')
INSERT INTO TRADER (trader_id, trader_name, trader_username, trader_password) VALUES (2,'B. JOHNS','trader2','password')

INSERT INTO TRADER_GROUPS (trader_group_id, client_id, trader_id) VALUES (1,1,1)
INSERT INTO TRADER_GROUPS (trader_group_id, client_id, trader_id) VALUES (2,2,1)
INSERT INTO TRADER_GROUPS (trader_group_id, client_id, trader_id) VALUES (3,1,2)
/*
INSERT INTO TRANSACTIONS (transaction_id, date_time, client_id, cusip, quantity) VALUES (1,,1,111111111,50)
INSERT INTO TRANSACTIONS (transaction_id, date_time, client_id, cusip, quantity) VALUES (2,,2,111111111,50)
INSERT INTO TRANSACTIONS (transaction_id, date_time, client_id, cusip, quantity) VALUES (3,,1,111111111,50)
INSERT INTO TRANSACTIONS (transaction_id, date_time, client_id, cusip, quantity) VALUES (3,,1,999999999,50)
*/

USE [BLBData]
GO

/****** Object:  View [dbo].[BondQuantity]    Script Date: 10/16/2012 14:20:57 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[BondQuantity]
AS
SELECT     dbo.BONDS.cusip, dbo.BONDS.name, dbo.BONDS.price, dbo.BONDS.par_value, dbo.BONDS.maturity_date, dbo.BONDS.yield_to_maturity, 
                      dbo.BONDS.current_yield, dbo.BONDS.coupon, dbo.BONDS.country_code, dbo.AVAILABLE_BONDS.quantity_available, dbo.RATINGS.rating_sp, 
                      dbo.BONDS.rating
FROM         dbo.AVAILABLE_BONDS RIGHT OUTER JOIN
                      dbo.BONDS ON dbo.AVAILABLE_BONDS.cusip = dbo.BONDS.cusip INNER JOIN
                      dbo.RATINGS ON dbo.BONDS.rating = dbo.RATINGS.rating

GO

EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane1', @value=N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[32] 4[18] 2[22] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "AVAILABLE_BONDS"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 84
               Right = 203
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "BONDS"
            Begin Extent = 
               Top = 6
               Left = 241
               Bottom = 114
               Right = 402
            End
            DisplayFlags = 280
            TopColumn = 6
         End
         Begin Table = "RATINGS"
            Begin Extent = 
               Top = 6
               Left = 440
               Bottom = 84
               Right = 588
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
      Begin ColumnWidths = 13
         Width = 284
         Width = 1500
         Width = 1500
         Width = 1410
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'BondQuantity'
GO

EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPaneCount', @value=1 , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'BondQuantity'
GO




